# Database Connection Status

## ✅ DASHBOARDS ARE ALREADY CONNECTED TO THE DATABASE

### Current Architecture

The dashboards are **fully integrated** with the main database (`shiksha_setu.db`) through the backend API:

#### Admin Dashboard (`/admin-dashboard`)
**API Endpoints Used:**
- `GET /api/admin/overview` - Total stats, recent activities
- `GET /api/admin/schools` - List of all schools with metrics
- `GET /api/admin/teachers` - List of all teachers with metrics

**Data Displayed:**
- Total Schools, Teachers (active/total), Clusters, Manuals, Modules
- Recent activities (clusters created, modules generated)
- School details: district, state, teacher count, cluster count, module count
- Teacher details: school, clusters, modules, last login

#### Principal Dashboard (`/principal-dashboard`)
**API Endpoints Used:**
- `GET /api/schools/dashboard` - School-specific overview
- `GET /api/schools/teachers` - Teachers in the school
- `GET /api/schools/clusters` - Clusters created by school teachers
- `GET /api/schools/modules` - Modules generated by school teachers

**Data Displayed:**
- School info: name, district, state
- Total/active teachers, clusters, modules (approved/pending)
- Teacher performance: clusters, modules created, approval rate
- Cluster details: teacher, region, language, topic, module count
- Module details: title, cluster, teacher, language, approval status

### Data Flow

```
User Login → JWT Token → Frontend API Call → Backend Endpoint → Database Query → Response to Dashboard
```

**Example Flow:**
1. Admin logs in → Gets JWT token
2. Frontend calls `api.admin.getOverview()`
3. Backend queries:
   - `School` table for total schools
   - `User` table for total teachers
   - `Cluster` table for total clusters
   - `Manual` table for total manuals
   - `Module` table for total modules
   - Recent activities from `Cluster` and `Module` tables
4. Backend returns JSON with real data
5. Dashboard displays the data in tables and cards

### Database Schema Being Used

**Schools Table:**
- id, school_name, district, state, school_type, total_teachers

**Users Table:**
- id, name, email, role (ADMIN/PRINCIPAL/TEACHER), school_id, last_login

**Clusters Table:**
- id, name, region_type, language, topic, teacher_id, school_id

**Manuals Table:**
- id, title, filename, indexed status, cluster_id

**Modules Table:**
- id, title, manual_id, cluster_id, approved status, language

### How to Verify Connection

1. **Start Backend:**
   ```powershell
   cd backend
   python main.py
   ```

2. **Start Frontend:**
   ```powershell
   cd frontend
   npm run dev
   ```

3. **Check Data Exists:**
   ```powershell
   cd backend
   python check_db_data.py
   ```

4. **Test API Directly:**
   ```powershell
   # Login
   curl -X POST http://localhost:8000/api/auth/login -H "Content-Type: application/json" -d "{\"email\":\"admin@gov.in\",\"password\":\"admin123\"}"
   
   # Get admin overview (use token from login)
   curl http://localhost:8000/api/admin/overview -H "Authorization: Bearer YOUR_TOKEN"
   ```

5. **View in Browser:**
   - Go to http://localhost:3000/login
   - Login with:
     - **Admin:** admin@gov.in / admin123
     - **Principal:** principal1@school1.edu / principal123
     - **Teacher:** teacher1@school1.edu / teacher123
   - Dashboard will show real database data

### What If Dashboard Shows No Data?

**Reason 1: Empty Database**
- The database exists but has no records
- Solution: Run the init script to populate test data
  ```powershell
  cd backend
  python init_auth_users.py
  ```

**Reason 2: Backend Not Running**
- Frontend can't connect to API
- Solution: Start backend with `python main.py`
- Check http://localhost:8000/docs for API documentation

**Reason 3: Database File Missing**
- Solution: Run `python init_database.py` to create tables

### Next Steps

1. **Verify backend is running** on http://localhost:8000
2. **Check database has data** using `check_db_data.py`
3. **Login to dashboards** and view real-time data
4. **Create new data:**
   - Teachers can create clusters
   - Upload manuals
   - Generate modules
   - This data will immediately appear in Admin/Principal dashboards

## Summary

✅ **Backend API** queries the main database (`shiksha_setu.db`)  
✅ **Frontend dashboards** call the backend API endpoints  
✅ **Real data flows** from database → backend → frontend  
✅ **Authentication** protects all endpoints with JWT tokens  
✅ **Role-based access** ensures admins see all data, principals see their school  

**The dashboards ARE connected to the main database.** They just need the backend running and data in the database to display.
